@model DoAnLTW_Nhom4.Models.Product

@{
    ViewData["Title"] = "Cập nhật sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid">
    <h1 class="mt-4">Cập nhật sản phẩm</h1>
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-edit me-1"></i>
            Thông tin sản phẩm
        </div>
        <div class="card-body">
            <form asp-action="Edit" method="post" enctype="multipart/form-data">
                <input type="hidden" asp-for="Id" />
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <div class="mb-3">
                    <label asp-for="Name" class="control-label">Tên sản phẩm</label>
                    <input asp-for="Name" class="form-control" />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Price" class="control-label">Giá</label>
                    <input asp-for="Price" class="form-control" type="number" />
                    <span asp-validation-for="Price" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Stock" class="control-label">Số lượng</label>
                    <input asp-for="Stock" class="form-control" type="number" />
                    <span asp-validation-for="Stock" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="CategoryId" class="control-label">Danh mục</label>
                    <select asp-for="CategoryId" class="form-control" asp-items="ViewBag.Categories"></select>

                </div>
                <div class="mb-3">
                    <label asp-for="BrandId" class="control-label">Thương Hiệu</label>
                    <select asp-for="BrandId" class="form-control" asp-items="ViewBag.Brands"></select>
                </div>
                <div class="mb-3">
                    <label class="control-label">Hình ảnh chính</label>
                    <input type="file" class="form-control" id="mainImage" name="ImageUrl" />
                    <img id="mainImagePreview" src="@Model.ImageUrl" class="img-thumbnail mt-2" style="max-width: 150px;" />
                </div>

                <div class="mb-3">
                    <label class="control-label">Hình ảnh phụ</label>
                    <input type="file" class="form-control" id="additionalImages" name="ImageUrls" multiple />
                    <div id="additionalImagesPreview" class="mt-2 d-flex flex-wrap">
                        @if (Model.ImageUrls != null)
                        {
                            @foreach (var image in Model.ImageUrls)
                            {
                                <img src="@image.ImageUrl" class="img-thumbnail m-1" style="max-width: 100px;" />
                            }
                        }
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">Thông số kỹ thuật</div>
                    <div class="card-body" id="specifications-container">
                        @if (Model.ProductSpecifications != null && Model.ProductSpecifications.Any())
                        {
                            @for (int i = 0; i < Model.ProductSpecifications.Count; i++)
                            {
                                <div class="row mb-3 specification-item">
                                    <div class="col-md-5">
                                        <input type="text" name="ProductSpecifications[@i].Key" class="form-control" value="@Model.ProductSpecifications[i].Key" placeholder="Tên thông số">
                                    </div>
                                    <div class="col-md-5">
                                        <input type="text" name="ProductSpecifications[@i].Value" class="form-control" value="@Model.ProductSpecifications[i].Value" placeholder="Giá trị">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-danger btn-remove-spec">Xóa</button>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                    <button type="button" class="btn btn-primary" id="btn-add-spec">Thêm thông số</button>
                </div>

                <div class="mt-3">
                    <button type="submit" class="btn btn-success">Lưu</button>
                    <a asp-action="Index" class="btn btn-secondary">Quay lại</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById("mainImage").addEventListener("change", function (event) {
        let reader = new FileReader();
        reader.onload = function () {
            document.getElementById("mainImagePreview").src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    });

    document.getElementById("additionalImages").addEventListener("change", function (event) {
        let previewContainer = document.getElementById("additionalImagesPreview");
        previewContainer.innerHTML = "";
        for (let file of event.target.files) {
            let reader = new FileReader();
            reader.onload = function () {
                let img = document.createElement("img");
                img.src = reader.result;
                img.classList.add("img-thumbnail", "m-1");
                img.style.maxWidth = "100px";
                previewContainer.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    });

        document.getElementById("btn-add-spec").addEventListener("click", function () {
        let specContainer = document.getElementById("specifications-container");
        let specCount = specContainer.getElementsByClassName("specification-item").length;

        let newSpec = document.createElement("div");
        newSpec.classList.add("row", "mb-3", "specification-item");
        newSpec.innerHTML = `
            <div class="col-md-5">
                <input type="text" name="ProductSpecifications[${specCount}].Key" class="form-control" placeholder="Tên thông số">
            </div>
            <div class="col-md-5">
                <input type="text" name="ProductSpecifications[${specCount}].Value" class="form-control" placeholder="Giá trị">
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-danger btn-remove-spec">Xóa</button>
            </div>
        `;

        specContainer.appendChild(newSpec);
    });

    document.addEventListener("click", function (event) {
        if (event.target.classList.contains("btn-remove-spec")) {
            event.target.parentElement.parentElement.remove();
        }
    });

</script>
